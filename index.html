<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Квест MYSQL(Денисов)</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="styles/default.css">

</head>

<body>
	<div class="container">
		<div class="nav flex-column nav-pills fixed-top" id="v-pills-tab" role="tablist" aria-orientation="vertical">
			<a class="nav-link" href="#task1">Задание 1</a>
			<a class="nav-link" href="#task2">Задание 2</a>
		</div>
		<a href=""></a>
		<section>
			<h2 id="task1">Задание 1. Создание базы данных для сайта агентства недвижимости</h2>
			<p>Задание: Спроектировать БД агентства недвижимости: результатом должны стать: схема БД в .png, .mwb и .sql скрипт создания базы, база на сервере в облаке</p>
			<div>
			<h3>Решение:</h3>
				<img class="border border-secondary" src="https://d.radikal.ru/d21/1803/1d/c1922e689208.png" alt="">
				<div class="my-4">
					<div>Ссылки на скачивание:</div>
					<div><a href="https://cloud.mail.ru/public/NBkA/QFWNzcxTe">quest_bl_db.mwb</a></div>
					<div><a href="https://cloud.mail.ru/public/GrEa/1LpTfHud5">quest_bl_db.pdf</a></div>
				</div>

				<pre class="border border-success"><code class="SQL">
SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

CREATE TABLE IF NOT EXISTS `mydb`.`estate_objects` (
  `idreal estate_objects` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `type` ENUM('дом', 'квартира', 'склад', 'офис', 'гараж', 'дача') NULL,
  `area` SMALLINT UNSIGNED NULL DEFAULT 0,
  `adress` VARCHAR(100) NULL,
  `post_index` MEDIUMINT UNSIGNED NULL,
  `rooms` TINYINT UNSIGNED NULL DEFAULT 0,
  `description` VARCHAR(3000) NULL,
  `price` VARCHAR(45) NULL,
  PRIMARY KEY (`idreal estate_objects`),
  UNIQUE INDEX `idreal estate-objects_UNIQUE` (`idreal estate_objects` ASC))
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `mydb`.`customers` (
  `idcustomers` INT UNSIGNED NOT NULL,
  `first_name` VARCHAR(33) NOT NULL DEFAULT 'Фамилия',
  `last_name` VARCHAR(33) NOT NULL DEFAULT 'Имя',
  `age` TINYINT UNSIGNED NULL,
  `gender` ENUM('male', 'female') NULL,
  `date_of_birth` DATE NULL,
  `phone_number` CHAR(10) NOT NULL DEFAULT 'Телефон',
  `email` VARCHAR(45) NOT NULL DEFAULT 'e-mail',
  `estate_objects_idreal estate_objects` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`idcustomers`),
  UNIQUE INDEX `idcustomers_UNIQUE` (`idcustomers` ASC),
  INDEX `fk_customers_estate_objects_idx` (`estate_objects_idreal estate_objects` ASC),
  UNIQUE INDEX `phone_number_UNIQUE` (`phone_number` ASC),
  UNIQUE INDEX `email_UNIQUE` (`email` ASC),
  UNIQUE INDEX `estate_objects_idreal estate_objects_UNIQUE` (`estate_objects_idreal estate_objects` ASC),
  CONSTRAINT `fk_customers_estate_objects`
    FOREIGN KEY (`estate_objects_idreal estate_objects`)
    REFERENCES `mydb`.`estate_objects` (`idreal estate_objects`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
</code></pre>
			</div>
		</section>
<!--------------------------------------------------------------------------->
		<section>
			<h2 class="mt-5" id="task2">Задание 2.</h2>
			<p>Задание: Написать вопросы на вставку данных в таблицы: insert, load data. Вставить данные в разработанную БД. Данные должны быть максимально приближены к реальным.</p>
			<div>
				<h3>Решение:</h3>
				<h4>Запрос на вставку данных INSERT</h4>
				<pre class="border border-success"> <code class="SQL">
INSERT INTO estate_objects
SET type = 'квартира', area = '77' , adress = 'Москва', post_index = '142222',
rooms = '3', description = 'Большая престижная квартира в сталинке', price = '30000000';
				</code></pre>
				<h4>Результат:</h4>
							<img src="https://a.radikal.ru/a03/1803/4a/d0b9f592bc0c.png" alt="">
								<img class="border border-secondary" src="#" alt="">
								
				<h4 class="mt-3">Запрос на вставку данных LOAD DATA</h4>
				<p>Создаем .csv в котором заполняем поля соответственно таблице в которую будем будем вставлять. Перекодируем из windows-1251 в UTF-8</p>
				<img class="border border-secondary" src="https://c.radikal.ru/c08/1803/ef/aeec61ec13ee.png" alt="">
				
				<p class="mt-4">Cпрашиваем у mysql в какую в какую папку нужно положить .csv</p>
				<pre class="border border-success"><code class="SQL">SHOW VARIABLES LIKE "secure_file_priv";</code></pre>
				<img src="https://c.radikal.ru/c08/1803/00/69b71cc6e3c3.png" alt="">
				<p class="mt-4">Пишем запрос:</p>
				<pre class="border border-success"><code class="SQL">
LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/customers.csv'
INTO TABLE customers
FIELDS TERMINATED BY ';' -- Excel делит ячейки не запятой а точкой с запятой
LINES TERMINATED BY '\r\n'
IGNORE 1 ROWS;
			</code></pre>
				
				<h4>Результат:</h4>
								<img class="border border-secondary" src="https://b.radikal.ru/b29/1803/de/2ec23a14ee38.png" alt="">
			</div>
		</section>
	</div>
	<script src="highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>

</html>
